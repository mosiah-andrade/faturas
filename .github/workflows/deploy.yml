name: Deploy to Hostinger

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4

    - name: ðŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: ðŸ“¦ Install dependencies
      run: npm install
      working-directory: ./gestao-fatura

    - name: ðŸ”¨ Build Frontend
      run: npm run build
      working-directory: ./gestao-fatura

    # --- NOVO PASSO: Juntar Frontend + Backend ---
    - name: ðŸ“‚ Prepare files for deploy
      run: |
        mkdir deploy_package
        # 1. Copia o site (Frontend) para a raiz do pacote
        cp -r gestao-fatura/dist/* deploy_package/
        # 2. Copia a pasta da API
        cp -r api deploy_package/api
        # 3. Copia e renomeia o config de produÃ§Ã£o para config.php
        cp config.prod.php deploy_package/config.php

    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./deploy_package/  # <--- Enviamos a pasta combinada
        server-dir: ./                # <--- Para a raiz da Hostinger
        protocol: ftps
        port: 21
        security: loose